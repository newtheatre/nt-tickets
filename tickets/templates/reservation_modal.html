<table class="bordered-dark">
<!-- Table header -->
  <thead>
    <tr class="grey-text text-lighten-4">
      <th data-field="name">Name</th>
      <th data-field="quantity">Quantity</th>
      <th data-field="add">Add</th>
    </tr>
  </thead>
  <!-- Table body -->
  <tbody class="list">
    {% for tick in report.tickets %}
      <!-- Cancelled Tickets -->
      {% if tick.cancelled %}
      <tr>
        <td class="red-text text-lighten-3 name"><strike>{{ tick.person_name }}</strike></td>
        <td class="grey-text valign-wrapper">
        <i class="material-icons" id="less_{{ forloop.counter }}">chevron_left</i>
        &nbsp;
        <strike>{{ tick.quantity }}</strike>
        &nbsp;
        <i class="material-icons" id="more_{{ forloop.counter }}">chevron_right</i>
        </td>
        <td><button type="button" class="btn" id="add_button_{{ forloop.counter }}" disabled>Add</button></td>
      </tr>
      <!-- Collected Tickets -->
      {% elif tick.collected %}
      <tr>
        <td class="blue-text text-lighten-3 name"><strike>{{ tick.person_name }}</strike></td>
        <td class="grey-text valign-wrapper">
        <i class="material-icons" id="less_{{ forloop.counter }}">chevron_left</i>
        &nbsp;
        <strike>{{ tick.quantity }}</strike>
        &nbsp;
        <i class="material-icons" id="more_{{ forloop.counter }}">chevron_right</i>
        </td>
        <td><button type="button" class="btn" id="add_button_{{ forloop.counter }}" disabled>Add</button></td>
      </tr>
      <!-- Everything else -->
      {% else %}
      <tr>
        <td class="nnt-text text-orange name">{{ tick.person_name }}</td>
        <td class="teal-text text-accent-4">
        <li class="waves-effect" onclick="lessTickets( {{ forloop.counter }} )" id="less_{{ forloop.counter }}"><i class="material-icons">chevron_left</i></li>
        &nbsp;
        <span id="reserve-number_{{ forloop.counter }}">{{ tick.quantity }}</span>
        &nbsp;
        <li class="waves-effect" onclick="moreTickets( {{ forloop.counter }} )" id="more_{{ forloop.counter }}"><i class="material-icons">chevron_right</i></li>
        </td>
        <td><form class="reserve-form" id="reserve_{{ forloop.counter }}" method="post" action=".">
        {% csrf_token %}
        <input type="hidden" value="{{ tick.unique_code }}" id="code_reserve_{{ forloop.counter }}" readonly="true">
        <input type="hidden" value="{{ tick.quantity }}" id="max_reserve_{{ forloop.counter }}" readonly="true">
        <input type="hidden" value="{{ tick.quantity }}" id="number_reserve_{{ forloop.counter }}" readonly="true">
        <button 
          type="submit" 
          class="btn nnt purple waves-effect waves-dark">
          Add
        </button>
        </form>
        </td>
      </tr>
      {% endif %}
    {% endfor %}
  </tbody>
</table>

<script>
  $(document).on('submit', '.reserve-form', function(event){
    var id = $(this).attr('id');
    event.preventDefault();
    // console.log("Collect form submitted");  // sanity check
    collect_tickets(id);
    $('#modal2').closeModal();
    return false;
  });
</script>

<script>
  function lessTickets(id) {
    var num = $('#number_reserve_' + id).val();
    num = +num - 1;
    if (num <= 1) {
      num = 1;
    }
    document.getElementById('reserve-number_' + id).innerHTML = num;
    $('#number_reserve_' + id).val(num);
  }
</script>

<script>
  function moreTickets(id) {
    var num = $('#number_reserve_' + id).val();
    var max = $('#max_reserve_' + id).val();
    num = +num + 1;
    if (num >= max) {
      num = max;
    }
    document.getElementById('reserve-number_' + id).innerHTML = num;
    $('#number_reserve_' + id).val(num);
  }
</script>
